# Calamares â€” Shell process (Lunariod post-install)
---
dontChroot: false
timeout: 300

script:
    # Enable sudo for wheel group
    - command: "sed -i 's/^# %wheel ALL=(ALL:ALL) ALL/%wheel ALL=(ALL:ALL) ALL/' /etc/sudoers"

    # Deploy Lunariod branding
    - command: "cp /etc/os-release /etc/os-release.bak 2>/dev/null; true"

    # Enable multilib repo in installed system
    - command: "sed -i '/^#\\[multilib\\]/{s/^#//;n;s/^#//}' /etc/pacman.conf"

    # Gaming tweaks
    - command: "echo 'vm.max_map_count=2147483642' > /etc/sysctl.d/80-gamecompatibility.conf"

    # Set up Flatpak + Flathub
    - command: "flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo"

    # Remove live-session-only files
    - command: "rm -f /etc/systemd/system/getty@tty1.service.d/autologin.conf"
    - command: "rm -f /root/.zprofile"
    - command: "rm -f /usr/share/applications/lunariod-installer.desktop"
    - command: "rm -rf /etc/calamares"

    # Remove Chaotic-AUR repo from installed system (not needed after install)
    - command: "sed -i '/\\[chaotic-aur\\]/,/Include.*chaotic/d' /etc/pacman.conf"
    - command: "rm -f /etc/pacman.d/chaotic-mirrorlist"
